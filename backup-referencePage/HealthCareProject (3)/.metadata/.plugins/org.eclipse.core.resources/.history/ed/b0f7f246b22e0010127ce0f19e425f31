package testClasses;
import java.time.Duration;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.NoSuchElementException;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.Listeners;
import org.testng.annotations.Test;
import pageClasses.RecordPatientConditionsPage;
import utilities.BaseClass;
import utilities.ListenerImplementation;
@Listeners(ListenerImplementation.class)
public class RecordPatientConditionsTest extends BaseClass{
	
	@Test(priority = 3, groups = {"sanity"},retryAnalyzer = utilities.RetryAnalyzer.class)
	public static void recordPatientCondition() throws InterruptedException
	{
		LoginTest.executeLoginTest();
		Thread.sleep(10000);

		scrollToTableHeader(driver);

		addExplicitWait3(RecordPatientConditionsPage.clickPatName());
		driver.findElement(RecordPatientConditionsPage.clickPatName()).click();
		
		/* click on Conditions link - elementToBeClickable */
		//addExplicitWait_elementclickable(RecordPatientConditionsPage.clickOnConditions());
		//driver.findElement(RecordPatientConditionsPage.clickOnConditions()).click();

		/*  click on record conditions link , elementToBeClickable */
		addExplicitWait_elementclickable(RecordPatientConditionsPage.clickOnRecordConditionLink());
		driver.findElement(RecordPatientConditionsPage.clickOnRecordConditionLink()).click();
		
		
		/* click on Searchbox */
//		addExplicitWait(RecordPatientConditionsPage.clickONSearchCondition());
//		WebElement searchbox_Condition = driver.findElement(RecordPatientConditionsPage.clickONSearchCondition());
//		searchbox_Condition.sendKeys("Typhoid fever");
//		searchbox_Condition.sendKeys(Keys.RETURN);
		//Thread.sleep(2000);
		
		
		addExplicitWait(RecordPatientConditionsPage.clickONSearchCondition());
		WebElement searchbox_Condition = driver.findElement(RecordPatientConditionsPage.clickONSearchCondition());
		searchbox_Condition.sendKeys("Typhoid fever");
		searchbox_Condition.sendKeys(Keys.RETURN);
		
		String CondtionVal=searchbox_Condition.getText();
		
		 /* click on clickon caledar */		
		
		addExplicitWait_presenceOfElementLocated(RecordPatientConditionsPage.clickOnCalendar()); 
		driver.findElement(RecordPatientConditionsPage.clickOnCalendar()).click();
		
		Thread.sleep(1000);
		addExplicitWait(RecordPatientConditionsPage.clickOnDay());	
		By day=RecordPatientConditionsPage.clickOnDay();
		driver.findElement(RecordPatientConditionsPage.clickOnDay()).sendKeys("12");
		Thread.sleep(1000);
		
		addExplicitWait(RecordPatientConditionsPage.clickOnMonth());
		By month=RecordPatientConditionsPage.clickOnMonth();
		driver.findElement(RecordPatientConditionsPage.clickOnMonth()).sendKeys("05"); // for May
		
		Thread.sleep(1000);
		addExplicitWait(RecordPatientConditionsPage.clickOnYear());
		By Year=RecordPatientConditionsPage.clickOnYear();
		driver.findElement(RecordPatientConditionsPage.clickOnYear()).sendKeys("2025");
		
          /*select Clicnical Status*/
		addExplicitWait(RecordPatientConditionsPage.selectClinicalStatus());
		By ClinicalStatus=RecordPatientConditionsPage.clickOnYear();
		//Thread.sleep(1000);
		driver.findElement(RecordPatientConditionsPage.selectClinicalStatus()).click();
		
		//scrollDown();
		scrollToBottom(driver);
		//Thread.sleep(3000);
		//System.out.println(driver.getPageSource());
		/* Save the new Patient Conditions */
		//addExplicitWait_elementclickable(RecordPatientConditionsPage.clickOnSaveAndClose());	
		//driver.findElement(RecordPatientConditionsPage.clickOnSaveAndClose()).click();
		
//		WebElement saveButton = driver.findElement(RecordPatientConditionsPage.clickOnSaveAndClose());
//		((JavascriptExecutor) driver).executeScript("arguments[0].scrollIntoView(true);", saveButton);
//		saveButton.click();
		
		WebDriverWait wait1 = new WebDriverWait(driver, Duration.ofSeconds(60));
		WebElement saveButton = wait1.until(ExpectedConditions.elementToBeClickable(RecordPatientConditionsPage.clickOnSaveAndClose()));
		saveButton.click();
		
		
		scrollToBottom(driver);
//		
        // Thread.sleep(8000);
		
//		// Wait for table to load
        WebDriverWait wait12 = new WebDriverWait(driver, Duration.ofSeconds(50));
        WebElement table = wait12.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//section[contains(@class,'cds--data-table-container')]//thead/tr")));
//
//     // Get the last row
//        List<WebElement> rows = table.findElements(By.xpath(".//tr"));
//        if (rows.isEmpty()) {
//            throw new NoSuchElementException("No rows found in Condition table.");
//        }
			
		/* Get initial row count*/
	    int initialRowCount = RecordPatientConditionsPage.getConditionRowCount(driver);
	    System.out.println("initialRowCount : " +initialRowCount);
	     
	    /* Wait until row count increases*/
//        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(60));
//        wait.until(d -> RecordPatientConditionsPage.getConditionRowCount(driver) > initialRowCount);

//        /* Get new row count and assert */
//        int newRowCount = RecordPatientConditionsPage.getConditionRowCount(driver);
//        Assert.assertEquals(newRowCount, initialRowCount + 1, "Row count did not increase as expected.");
//        System.out.println("Entered Record Patient Condtions is added and new row count is increased as expected");
//        
//        /* actual input values */
//        String actual_Condition_val = CondtionVal;
//	    String actuald_OnSetDate_val = day+"-"+month+"-"+Year; // Ensure it matches expected table format
//	    String actual_ClinicalStatus_val = ClinicalStatus.toString();
//		
//	    /* Fetch latest values from table (after row is added!)  */
//        String expected_ConditionInTable = RecordPatientConditionsPage.getLatestConditionValue(driver);
//	    String expected_OnSetDateInTable = RecordPatientConditionsPage.getLatestDateValue(driver);
//	    String expected_ClinicalStatusInTable = RecordPatientConditionsPage.getLatestStatusValue(driver);
//	    
//	   /* Compare actual vs expected */
//	    Assert.assertEquals(expected_ConditionInTable, actual_Condition_val, "Condition does not match.");
//	    Assert.assertEquals(expected_OnSetDateInTable, actuald_OnSetDate_val, "Onset Date does not match.");
//	    Assert.assertEquals(expected_ClinicalStatusInTable, actual_ClinicalStatus_val, "Clinical Status does not match.");
// 
//        
//        boolean isDataDisplayed = RecordPatientConditionsPage.isConditionDisplayed(actual_Condition_val, actuald_OnSetDate_val, actual_ClinicalStatus_val,driver);        
//        Assert.assertTrue(isDataDisplayed, "Entered condition row not found in the table.");
//        System.out.println("Entered condition data is correctly displayed in the table.");
//        
//        
		Thread.sleep(4000);
		
	}
	
}